<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apknixy Task - Professional Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #6C63FF; --dark: #2F2E41; --light: #F4F6F8; --green: #00B894; }
        body { font-family: 'Poppins', sans-serif; background: var(--light); margin: 0; padding: 20px; color: var(--dark); }
        .card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); margin-bottom: 20px; text-align: center; }
        .balance-box { background: linear-gradient(135deg, #6C63FF, #4834d4); color: white; padding: 30px; border-radius: 20px; position: relative; overflow: hidden; }
        .balance-amount { font-size: 48px; font-weight: 700; margin: 10px 0; }
        .coin-anim { position: absolute; width: 30px; height: 30px; background: gold; border-radius: 50%; opacity: 0; animation: coinFly 1s ease-out; }
        @keyframes coinFly { 0% { top: 100%; opacity: 1; } 100% { top: 20%; opacity: 0; } }

        .btn { width: 100%; padding: 15px; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: 0.3s; margin-top: 10px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-green { background: var(--green); color: white; }
        
        .profile-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 100; align-items: center; justify-content: center; }
        .modal-content { background: white; padding: 30px; border-radius: 15px; width: 85%; max-width: 400px; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        
        /* AD SPACES */
        .ad-banner { margin: 20px 0; text-align: center; overflow: hidden; }
    </style>
</head>
<body>

    <div id="login-screen" style="text-align:center; margin-top:100px;">
        <h1>Welcome to Apknixy</h1>
        <p>Login to start earning ‚Çπ1 per minute</p>
        <button class="btn btn-primary" onclick="googleLogin()">Login with Google</button>
    </div>

    <div id="dashboard" style="display:none;">
        
        <div class="card balance-box" id="balCard">
            <div>Current Balance</div>
            <div class="balance-amount">‚Çπ<span id="userBal">0.00</span></div>
            <small>Click Start Task to Earn</small>
        </div>

        <div id="profile-warn" class="card" style="border: 2px solid orange; display:none;">
            <h3 style="color:orange;">‚ö†Ô∏è Profile Incomplete</h3>
            <p>Please complete your profile to withdraw money.</p>
            <button class="btn btn-primary" onclick="openProfile()">Complete Profile</button>
        </div>

        <div class="card">
            <h3>üöÄ Daily Tasks</h3>
            <p>Completed: <span id="dailyCount">0</span>/1000</p>
            
            <div id="task-buttons">
                <button class="btn btn-green" id="startBtn" onclick="startTaskSession()">START TASK 1</button>
            </div>
            
            <div style="margin-top:15px; font-size:12px; color:gray;">
                <label><input type="checkbox" id="autoMode" checked> Auto Mode (Auto Scroll & Next)</label>
            </div>
        </div>

        <div class="card">
            <h3>üí∏ Withdraw</h3>
            <input type="number" id="wAmount" placeholder="Amount (Min ‚Çπ500)">
            <button class="btn btn-primary" onclick="requestWithdraw()">Withdraw Money</button>
        </div>

        <div class="ad-banner">
            <ins style="width: 728px;height:90px" data-width="728" data-height="90" class="y9ce5119f35" data-domain="//data527.click" data-affquery="/388273335727fcad9412/9ce5119f35/?placementName=Banner"><script src="//data527.click/js/responsive.js" async></script></ins>
        </div>

    </div>

    <div id="profileModal" class="profile-modal">
        <div class="modal-content">
            <h3>Complete Profile</h3>
            <input type="text" id="pName" placeholder="Full Name">
            <input type="number" id="pAge" placeholder="Age">
            <input type="date" id="pDob" placeholder="Date of Birth">
            <input type="text" id="pUpi" placeholder="UPI ID (e.g. 9876543210@ybl)">
            <button class="btn btn-green" onclick="saveProfile()">Save Details</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBXOBu6fmbco27_ugn9pFg2XQ-TaIeNRpY",
            authDomain: "apknixy-bc9ee.firebaseapp.com",
            projectId: "apknixy-bc9ee",
            storageBucket: "apknixy-bc9ee.firebasestorage.app",
            messagingSenderId: "99276264960",
            appId: "1:99276264960:web:a4f28913305288544e2ae5"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        let user = null;
        let userData = {};

        auth.onAuthStateChanged(u => {
            if (u) {
                user = u;
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                loadData();
            }
        });

        function googleLogin() { auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }

        function loadData() {
            db.collection('users').doc(user.uid).onSnapshot(doc => {
                if(doc.exists) {
                    userData = doc.data();
                    document.getElementById('userBal').innerText = (userData.balance || 0).toFixed(2);
                    document.getElementById('dailyCount').innerText = userData.dailyCount || 0;
                    
                    // Task Button Logic
                    const nextTask = (userData.dailyCount || 0) + 1;
                    if(nextTask > 1000) {
                        document.getElementById('startBtn').innerText = "All Tasks Completed (Reset Tomorrow)";
                        document.getElementById('startBtn').disabled = true;
                    } else {
                        document.getElementById('startBtn').innerText = `START TASK ${nextTask}`;
                        document.getElementById('startBtn').disabled = false;
                    }

                    // Profile Check
                    if(!userData.upi || !userData.dob) {
                        document.getElementById('profile-warn').style.display = 'block';
                    } else {
                        document.getElementById('profile-warn').style.display = 'none';
                    }
                } else {
                    // New User Setup
                    db.collection('users').doc(user.uid).set({
                        email: user.email, balance: 0, dailyCount: 0
                    });
                }
            });
        }

        function openProfile() { document.getElementById('profileModal').style.display = 'flex'; }
        
        function saveProfile() {
            const name = document.getElementById('pName').value;
            const age = document.getElementById('pAge').value;
            const dob = document.getElementById('pDob').value;
            const upi = document.getElementById('pUpi').value;

            if(!name || !age || !dob || !upi) return alert("Fill all fields");

            db.collection('users').doc(user.uid).update({
                name, age, dob, upi
            }).then(() => {
                alert("Profile Saved!");
                document.getElementById('profileModal').style.display = 'none';
            });
        }

        function startTaskSession() {
            const isAuto = document.getElementById('autoMode').checked;
            const nextTask = (userData.dailyCount || 0) + 1;
            // Go to Dynamic Task Page
            window.location.href = `task.html?id=${nextTask}&auto=${isAuto}`;
        }
        
        function requestWithdraw() {
            const amt = parseFloat(document.getElementById('wAmount').value);
            if(amt < 500) return alert("Min Withdraw: ‚Çπ500");
            if(amt > userData.balance) return alert("Insufficient Balance");
            if(!userData.upi) return alert("Complete Profile First");

            db.collection('withdrawals').add({
                userId: user.uid, amount: amt, status: 'pending', date: new Date(), upi: userData.upi
            }).then(() => {
                db.collection('users').doc(user.uid).update({
                    balance: firebase.firestore.FieldValue.increment(-amt)
                });
                alert("Withdraw Request Sent!");
            });
        }
    </script>
</body>
</html>
